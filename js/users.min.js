//** OIR - OPAC.isisRBE
function getAction(){var e=document.getElementById("susers").selectedIndex,t=document.getElementById("susers").options[e].value;document.getElementById("expressao").value="SIGLA "+t,document.getElementById("frmseluser").submit()}function getActionHistRes(e){for(var t=document.getElementById("ophist").selectedIndex,n=document.getElementById("ophist").options[t].value,r=0,a=0;a<document.frmHistRes.situacao.length;a++)document.frmHistRes.situacao[a].checked&&(r+=parseInt(document.frmHistRes.situacao[a].value));var o="";switch(r){case 1:o="EST 0";break;case 3:o="EST 1";break;case 4:o="(EST 0 OR EST 1)";break;case 5:o="EST 2";break;case 6:o="(EST 0 OR EST 2)";break;case 8:o="(EST 1 OR EST 2)";break;case 9:o=""}tmp=o;var i=0;for(a=0;a<document.frmHistRes.ambito.length;a++)document.frmHistRes.ambito[a].checked&&(i+=parseInt(document.frmHistRes.ambito[a].value));switch(o="",i){case 1:o="admin"==e.toLowerCase()?"":"AGR "+e;break;case 3:o="admin"==e.toLowerCase()?"":"REQ "+e;break;case 4:o="admin"==e.toLowerCase()?"":"(AGR "+e+" OR REQ "+e+")"}tmp+=""!=o?" AND "+o:"",o="";var m=!0;switch(n){case"":alert("ATENÇÃO. Selecione um critério!"),m=!1;break;case"X":o="$";break;case"l":o="TU leitor AND REQ "+document.getElementById("incampo").value;break;case"a":o="AGR "+document.getElementById("incampo").value+document.getElementById("exata").checked?"":"$";break;case"b":o="BIB "+document.getElementById("incampo").value+document.getElementById("exata").checked?"":"$"}tmp+=""==tmp&&"$"==o?"$":""==tmp?o:" AND "+o,document.getElementById("express1").value=tmp,m&&document.getElementById("frmHistRes").submit()}function getActionRes(){var e=document.getElementById("estado").selectedIndex,t=document.getElementById("estado").options[e].value;"X"!=t&&(document.getElementById("express").value+=" AND EST "+t),document.getElementById("frmgesres").submit()}function getOp(){var e=document.getElementById("criterio").selectedIndex;switch(document.getElementById("criterio").options[e].value){case"X":document.getElementById("frmgescol").action="../admin/colselop.asp";break;case"i":document.getElementById("frmgescol").action="../cgi/www.exe/[in=mnucol.in]",document.getElementById("mnu").value="2";break;case"c":document.getElementById("frmgescol").action="../cgi/www.exe/[in=mnucol.in]",document.getElementById("mnu").value="3"}document.getElementById("frmgescol").submit()}function getOpCol(){var e=document.getElementById("opges").selectedIndex,t=document.getElementById("opges").options[e].value;if(""!=t&&""==document.getElementById("termo").value)return alert("ATENÇÃO! O termo não pode ficar vazio."),!1;var n=t+" "+document.getElementById("termo").value,r=!1;document.getElementById("op").value.toUpperCase()==document.getElementById("base").value.toUpperCase()&&(r=!0),document.getElementById("op").value=document.getElementById("op").value.toUpperCase(),document.getElementById("expressao").value="X"==document.getElementById("op").value||1==r?n:"SI "+document.getElementById("op").value+" AND "+n,0==document.getElementById("PFX").checked&&(document.getElementById("expressao").value+="$"),(""==document.getElementById("limites").value||parseInt(document.getElementById("limites").value)<=0||parseInt(document.getElementById("limites").value)>1e3)&&(document.getElementById("limites").value="25"),document.getElementById("frmselcri").submit()}function getOpsel(){var e=document.getElementById("susers").selectedIndex;if(-1==e)return alert("ATENÇÃO! É necessário selecionar um utilizador."),!1;var t=document.getElementById("susers").options[e].value.split("~~");document.getElementById("base").value=t[1],document.getElementById("users").value=t[0],"False"!=FileExists("../admin/chkfile.asp?vdir=/rbcatalogo&fname="+t[1].toLowerCase()+"&d="+(new Date).getTime())?("2"==document.getElementById("mnu").value?document.getElementById("frmselcri").action="../../admin/colselop.asp":(document.getElementById("base").value=document.getElementById("base").value.toLowerCase(),document.getElementById("frmselcri").action="../../admin/graficos.asp"),document.getElementById("frmselcri").submit()):alert("ATENÇÃO! Biblioteca sem base de dados carregada no sistema.")}function validadados(e){var t=!0,n=!0,r="",a="",o="";if(!ValidateEmail(document.getElementById("v11")))return!1;if(-1!=e){if(document.getElementById("v7").value!=document.getElementById("confirma").value&&(r="As senhas não coincidem.\n",t=!1),""==document.getElementById("v1").value)o="ID",t=!1;else{var i=parseInt(document.getElementById("v1").value);isNaN(i)&&(a="O campo ID tem de ser numérico!\n",t=!1)}""==document.getElementById("v2").value&&(o=""!=o?o+",SIGLA":o+"SIGLA",t=!1)}(""==document.getElementById("v3").value&&(o=""!=o?o+",NOME":o+"NOME",t=!1),-1!=e&&""==document.getElementById("v7").value&&(o=""!=o?o+",SENHA":o+"SENHA",t=!1),""!=o&&(o="Os campos "+o+" são obrigatórios."),""!=document.getElementById("v22").value)&&(ValidateGPS(document.getElementById("v22").value)||(n=!1));""!=document.getElementById("v23").value&&(ValidateGPS(document.getElementById("v23").value)||(n=!1));return n||(a+="As coordenadas GPS devem ser valores numéricos [ex: -9,02345].\n",t=!1),t||alert("ATENÇÃO! Existem erros no preenchimento do formulário.\n\n"+a+r+o),t}function validadadosLeitor(){var e=!0,t="",n="";if(!ValidateData(document.getElementById("v3")))return!1;if(!ValidateEmail(document.getElementById("v9")))return!1;if(""==document.getElementById("v20").options[document.getElementById("v20").selectedIndex].value&&(t="BIBLIOTECA",e=!1),""==document.getElementById("v1").value)t=""!=t?t+",Nº de LEITOR":t+"Nº de LEITOR",e=!1;else{var r=parseInt(document.getElementById("v1").value);isNaN(r)&&(n="O campo N.º de leitor tem de ser numérico!\n",e=!1)}return""==document.getElementById("v2").value&&(t=""!=t?t+",NOME":t+"NOME",e=!1),""==document.getElementById("v4").value&&(t=""!=t?t+",MORADA":t+"MORADA",e=!1),""==document.getElementById("v5").value&&(t=""!=t?t+",CONCELHO":t+"CONCELHO",e=!1),""!=t&&(t="O(s) campo(s) "+t+" é(são) obrigatório(s).\n"),e||alert("ATENÇÃO! Existem erros no preenchimento do formulário.\n\n"+t+n),e}function chkuser(){var e=new Date;return new Ajax.Request("../cgi/www.exe/[in=veruser.in]?sigla="+document.getElementById("v2").value.toLowerCase()+"&r="+e.getTime(),{method:"get",onSuccess:function(t){-1!=(t.responseText||"nao").indexOf("sim")?alert("ATENÇÃO! Já existe um utilizador com esta SIGLA ["+document.getElementById("v2").value.toUpperCase()+"]"):(document.getElementById("v7").value=check(document.getElementById("v7")),document.getElementById("confirma").value=check(document.getElementById("confirma")),validadados()&&(document.getElementById("frminuser").action="/rbcatalogo/cgi/www.exe/[in=newuser.in]?r="+e.getTime(),document.getElementById("frminuser").submit()))},onFailure:function(){alert("Ocorreu um erro. Contacte o administrador.")}}),!1}function chkleitor(){var e=new Date;return new Ajax.Request("../cgi/www.exe/[in=verleitor.in]?nome="+ConvUp(document.getElementById("v2").value)+"&r="+e.getTime(),{method:"get",onSuccess:function(t){-1!=(t.responseText||"nao").indexOf("sim")?alert("ATENÇÃO! Já existe um utilizador com este nome ["+document.getElementById("v2").value.toUpperCase()+"]"):validadadosLeitor()&&(document.getElementById("frminleitor").action="/rbcatalogo/cgi/www.exe/[in=newleitor.in]?r="+e.getTime(),document.getElementById("frminleitor").submit())},onFailure:function(){alert("Ocorreu um erro. Contacte o administrador.")}}),!1}function pwdRob(e){var t=new RegExp("^(?=.{8,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\\W).*$","g"),n=new RegExp("^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$","g"),r=new RegExp("(?=.{6,}).*","g"),a=document.getElementById("pwd");0==e.value.length?a.innerHTML="":0==r.test(e.value)?a.innerHTML="<img src='/rbcatalogo/imagens/picactions/pwd0.gif' border='0'>":t.test(e.value)?a.innerHTML="<img src='/rbcatalogo/imagens/picactions/pwd4.gif' border='0'>":n.test(e.value)?a.innerHTML="<img src='/rbcatalogo/imagens/picactions/pwd2.gif' border='0'>":a.innerHTML="<img src='/rbcatalogo/imagens/picactions/pwd1.gif' border='0'>"}function chgColor(e,t){switch(t){case!0:e.style.backgroundColor="#99ff66";break;case!1:e.style.backgroundColor="#fff"}}function alpha(e){for(var t=0;t<e.length;t++){var n=e.charAt(t).charCodeAt(0);if(!(n>64&&n<91||n>96&&n<123))return!1}return!0}var Utf8={encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},decode:function(e){for(var t="",n=0,r=c1=c2=0;n<e.length;)(r=e.charCodeAt(n))<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return t}};function trim(e){return e.replace(/^\s+|\s+$/g,"")}function ltrim(e){return e.replace(/^\s+/,"")}function rtrim(e){return e.replace(/\s+$/,"")}String.prototype.soundex=function(e){e=isNaN(e)?4:e>10?10:e<4?4:e;var t,n,r={BFPV:1,CGJKQSXZ:2,DT:3,L:4,MN:5,R:6},a=(s=this.toUpperCase().replace(/[^A-Z]/g,"").split("")).splice(0,1);for(t in s)for(n in r)if(n.indexOf(s[t])+1&&a[a.length-1]!=r[n]&&a.push(r[n]))break;return a.length>e&&(a.length=e),a.join("")+new Array(e-a.length+1).join("0")},Array.prototype.max=function(){for(var e=this[0],t=this.length,n=1;n<t;n++)this[n]>e&&(e=this[n]);return e},Array.prototype.min=function(){for(var e=this[0],t=this.length,n=1;n<t;n++)this[n]<e&&(e=this[n]);return e};var dtCh="-",minYear=1900,maxYear=2100;function isInteger(e){var t;for(t=0;t<e.length;t++){var n=e.charAt(t);if(n<"0"||n>"9")return!1}return!0}function stripCharsInBag(e,t){var n,r="";for(n=0;n<e.length;n++){var a=e.charAt(n);-1==t.indexOf(a)&&(r+=a)}return r}function daysInFebruary(e){return e%4!=0||e%100==0&&e%400!=0?28:29}function DaysArray(e){for(var t=1;t<=e;t++)this[t]=31,4!=t&&6!=t&&9!=t&&11!=t||(this[t]=30),2==t&&(this[t]=29);return this}function isDate(e){var t=DaysArray(12),n=e.indexOf(dtCh),r=e.indexOf(dtCh,n+1),a=e.substring(0,n),o=e.substring(n+1,r),i=e.substring(r+1);strYr=i,"0"==a.charAt(0)&&a.length>1&&(a=a.substring(1)),"0"==o.charAt(0)&&o.length>1&&(o=o.substring(1));for(var m=1;m<=3;m++)"0"==strYr.charAt(0)&&strYr.length>1&&(strYr=strYr.substring(1));return month=parseInt(o),day=parseInt(a),year=parseInt(strYr),-1==n||-1==r?(alert("O formato da data deve ser: dd-mm-yyyy ."),!1):o.length<1||month<1||month>12?(alert("Por favor indique um mês válido."),!1):a.length<1||day<1||day>31||2==month&&day>daysInFebruary(year)||day>t[month]?(alert("Por favor indique um dia do mês válido."),!1):4!=i.length||0==year||year<minYear||year>maxYear?(alert("Por favor indique um ano entre "+minYear+" e "+maxYear+"."),!1):-1==e.indexOf(dtCh,r+1)&&0!=isInteger(stripCharsInBag(e,dtCh))||(alert("Por favor indique uma data válida."),!1)}function ValidateEmail(e){var t=e.value;if(""==t)return!0;return!!/^\w+([-.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(t)||(e.value="",e.focus(),alert("Email inválido.\nPor favor indique um email válido no formato nome@servidor.dominio"),!1)}function ValidateData(e){return!(""!=e.value&&!isDate(e.value))||(e.value="",e.focus(),!1)}function ValidateSigla(e){var t=e.value;switch(t.toLowerCase()){case"admin":return e.value="",e.focus(),alert("O nome de agrupamento não é válido."),!1;case"":return!0;default:var n=!1;return new Ajax.Request("../cgi/www.exe/[in=veragr.in]?agr="+t.toLowerCase(),{method:"get",onSuccess:function(t){-1!=(t.responseText||"nao").indexOf("sim")?n=!0:(e.value="",e.focus(),alert("A entidade não existe ou o nome de agrupamento não é válido."))},onFailure:function(){alert("Ocorreu um erro. Contacte o administrador.")}}),n}}function ValidateGPS(e){if(e=rtrim(e),isNaN(parseInt(e)))return!1;return!!/^[+-]?\d+([,]\d+)*$/.test(e)}function check(e){return hex_md5(e.value)}function FileExists(e){return oHttp=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,oHttp.open("GET",e,!1),oHttp.send(),oHttp.responseText}