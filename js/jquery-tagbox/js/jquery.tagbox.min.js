/* jQuery TagBox - jQuery Plugin  1.0.1 (02/06/2011) http://www.geektantra.com  */
!function(a){a.fn.tagBox=function(e){var t={separator:",",className:"tagBox",tagInputClassName:"",tagButtonClassName:"",tagButtonTitle:"../../imagens/picactions/icon_tags.png",confirmRemoval:!1,confirmRemovalText:"Pretende mesmo remover a etiqueta?",completeOnSeparator:!0,completeOnBlur:!1,readonly:!1,enableDropdown:!1,dropdownSource:function(){},dropdownOptionsAttribute:"title",removeTagText:"X",maxTags:-1,maxTagsErr:function(a){alert("Apenas pode adicionar um total de "+a+" etiquetas!")},beforeTagAdd:function(a){},afterTagAdd:function(a){}};(e=e?a.extend(t,e):t).tagInputClassName=""!=e.tagInputClassName?e.tagInputClassName+" ":"",e.tagButtonClassName=""!=e.tagButtonClassName?e.tagButtonClassName+" ":"";this.length<1||this.each(function(){var t=Math.round(65536*Math.random()).toString(16)+Math.round(65536*Math.random()).toString(16),n=a(this);n.hide();try{var o=a.parseJSON(n.attr(e.dropdownOptionsAttribute));e=a.extend(o,e)}catch(a){console.log(a)}if(n.is(":disabled")&&(e.readonly=!0),a.isArray(n)&&n[0].hasAttribute("readonly")&&(e.readonly=!0),e.enableDropdown&&null!=e.dropdownSource())if(e.dropdownSource().jquery){(l=e.readonly?"":e.dropdownSource()).attr("id",e.className+"-input-"+t),l.addClass(e.className+"-input")}else{var r=a.parseJSON(e.dropdownSource()),s=new Array('<option value=""></option>');a.each(r,function(e,t){a.isArray(t)&&2==t.length?s.push('<option value="'+t[0]+'">'+t[1]+"</option>"):a.isArray(t)||s.push('<option value="'+e+'">'+t+"</option>")});var i='<select class="'+e.tagInputClassName+" "+e.className+'-input" id="'+e.className+"-input-"+t+'">'+s.join("")+"</select>",l=e.readonly?"":a(i)}else l=e.readonly?"":a('<input type="text" class="'+e.tagInputClassName+" "+e.className+'-input" value="" id="'+e.className+"-input-"+t+'" />');var c=e.readonly?"":a('<a href="javascript:void(0)" ><img border="0" src="'+e.tagButtonTitle+'" alt="Adicionar etiqueta" title="Adicionar etiqueta"></a>'),u=a('<span class="'+e.className+'-list" id="'+e.className+"-list-"+t+'"></span>'),p=a('<span class="'+e.className+'-container"></span>').append(l).append(c).append(u);function d(){var t=n.val().split(e.separator);return t=a.map(t,function(e){return a.trim(e)})}function m(o){o=a.unique(o.sort()).sort();u.html(""),a.each(o,function(n,o){if(""!=o){var r=e.readonly?"":'<a href="javascript:void(0)" class="'+e.className+"-remove "+e.className+"-remove-"+t+'" title="Remover etiqueta" rel="'+o+'">'+e.removeTagText+"</a>";if(e.enableDropdown&&a("#"+e.className+"-input-"+t).find("option").length>0)var s=a("#"+e.className+"-input-"+t).find("option[value='"+o+"']").text();else s=o;u.append('<span class="'+e.className+'-item"><span class="'+e.className+'-bullet">&bull;</span><span class="'+e.className+'-item-content">'+r+s+"</span></span>")}}),n.val(o.join(e.separator))}n.before(p),n.addClass("jQTagBox"),n.unbind("reloadTagBox"),n.bind("reloadTagBox",function(){p.remove(),n.tagBox(e)}),m(d()),e.readonly||(c.click(function(){var t=l.val();e.beforeTagAdd(t),function(t){var n=d();if(t=t.split(e.separator),t=a.map(t,function(e){return a.trim(e)}),n=n.concat(t),(n=a.map(n,function(a){if(""!=a)return a})).length>e.maxTags&&-1!=e.maxTags)return void e.maxTagsErr(e.maxTags);m(n)}(t),l.is("select")&&l.find('option[value="'+t+'"]').attr("disabled","disabled"),l.val(""),e.afterTagAdd(t)}),l.keypress(function(t){var n=t.keyCode?t.keyCode:t.which;a(this).val();if(13==n||n==e.separator.charCodeAt(0)&&e.completeOnSeparator)return c.trigger("click"),!1}),e.completeOnBlur&&l.blur(function(){""!=a(this).val()&&c.trigger("click")}),a("."+e.className+"-remove-"+t).live("click",function(){if(e.confirmRemoval&&!confirm(e.confirmRemovalText))return!1;var t,n,o=a(this).attr("rel");l.is("select")&&l.find('option[value="'+o+'"]').removeAttr("disabled"),l.val(""),t=o,n=d(),t=t.split(e.separator),t=a.map(t,function(e){return a.trim(e)}),a.each(t,function(e,t){n=a.grep(n,function(a){return a!=t})}),m(n)}))})}}(jQuery);